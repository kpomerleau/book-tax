corporate_tax_rate <- .21
debt_finance_share <- .32
interest_rate <- 0.068
interest_limit <- (1-0.16)
inflation <- 0.024
return_on_equity<-.058
r_d_credit<-0.0217
after_tax_return<-interest_rate * debt_finance_share + (return_on_equity + inflation) * (1-debt_finance_share)
discount_rate <- debt_finance_share * (interest_rate * (1 - (interest_limit)*corporate_tax_rate)) +
(1-debt_finance_share) * (return_on_equity+inflation)
straight_line<- function(discount_rate, asset_life, start_year, years_on){
z <- ((1-exp(-1*discount_rate*years_on))/(discount_rate*asset_life))*exp(-1*discount_rate*start_year)
return(z)
}
declining_balance_sl<- function(discount_rate, asset_life, start_year, years_on, rate){
beta <- rate/asset_life
time_on_db <- asset_life*(1-(1/rate))
z_a<-(1-(beta/(beta))*(1-exp(-1*beta*start_year)))
z_b<-(beta/(beta+discount_rate))*(1-exp(-1*(beta+discount_rate)*min(years_on,max(time_on_db-start_year,0))))*exp(-1*discount_rate*start_year)
z_db<-z_a*z_b
z_sl<-((exp(-1*beta*time_on_db)/((asset_life-time_on_db)*discount_rate))*(exp(-1*discount_rate*max(time_on_db,start_year))-exp(-1*discount_rate*min(asset_life,years_on))))
z<-z_db+z_sl
return(z)
}
economic_depreciation<- function(discount_rate, start_year, years_on, rate){
rate/(rate+discount_rate)*(exp(-1*(rate+discount_rate)*start_year)-exp(-1*(rate+discount_rate)*(years_on+start_year)))
}
#Need to add AMT credits
service_price<-function(z_present_value, discount_rate, economic_depreciation, corporate_tax_rate, r_d_credit, inflation){
service_price<-(discount_rate - inflation + economic_depreciation)*(1 - corporate_tax_rate * z_present_value - r_d_credit)/ (1 - corporate_tax_rate)
}
inventories<-function(share_lifo, holding_period, discount_rate, inflation, corporate_tax_rate){
s_fifo<- (((1/ holding_period)* log((exp(discount_rate * holding_period)- corporate_tax_rate)/ (1-corporate_tax_rate)))-inflation)
s_lifo<- ((1/ holding_period) * log((exp((discount_rate - inflation) * holding_period)-corporate_tax_rate)/ (1-corporate_tax_rate)))
s<- s_fifo * (1-share_lifo) + s_lifo * share_lifo
return(s)
}
metr<-function(service_price, economic_depreciation, rate_of_return){
metr<-((service_price - economic_depreciation) - (rate_of_return - inflation))/(service_price - economic_depreciation)
return(metr)
}
cost_recovery_GDS<-function(gds_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on,
years_on_econ){
if(dep_method == "Expensing"){z <- 1}
if(dep_method == "Economic"){
z<-economic_depreciation(discount_rate, start_year, years_on_econ, econ_depreciation)
}
if(dep_method =="DB 200%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 2)
}
if(dep_method =="DB 150%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 1.5)
}
if(dep_method =="SL"){
z<-straight_line(discount_rate, gds_life, start_year, years_on)
}
if(dep_method == "Land")(z<-0)
return(z)
}
cost_recovery_ADS<-function(ads_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on){
z<-straight_line(discount_rate, ads_life, start_year, years_on)
if(dep_method == "Land")(z<-0)
return(z)
}
cost_recovery_econ<-function(discount_rate,
start_year,
years_on,
rate){
z<-economic_depreciation(discount_rate, start_year, years_on, rate)
return(z)
}
#Vectorize my functions
vads<-Vectorize(cost_recovery_ADS)
vecon<-Vectorize(cost_recovery_econ)
vgds<-Vectorize(cost_recovery_GDS)
vservice_price<-Vectorize(service_price)
vmetr<-Vectorize(metr)
#Testing code
#Z values
assets$ads_z<-vads(assets$ADS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$ADS.Life)
assets$econ_z<-vecon(discount_rate, 0, Inf, assets$delta)
assets$gds_z<-vgds(assets$GDS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$GDS.Life, Inf)
#Service Price
assets$s<-vservice_price(assets$gds_z, discount_rate, assets$delta, corporate_tax_rate, (assets$major_asset_group == "Intellectual Property") * r_d_credit, inflation)
#METR
assets$metr<-round(metr(assets$s,assets$delta, after_tax_return), digits = 3)
setwd("C:/Users/kylep/Documents/Github/book-tax")
rm(list=ls())
options(scipen = 999)
assets<-read.csv("asset_data.csv", header = TRUE, fill = TRUE, sep = ",")
#Parameters
corporate_tax_rate <- .21
debt_finance_share <- .32
interest_rate <- 0.068
interest_limit <- (1-0.16)
inflation <- 0.024
return_on_equity<-.058
r_d_credit<-0.0217
after_tax_return<-interest_rate * debt_finance_share + (return_on_equity + inflation) * (1-debt_finance_share)
discount_rate <- debt_finance_share * (interest_rate * (1 - (interest_limit)*corporate_tax_rate)) +
(1-debt_finance_share) * (return_on_equity+inflation)
straight_line<- function(discount_rate, asset_life, start_year, years_on){
z <- ((1-exp(-1*discount_rate*years_on))/(discount_rate*asset_life))*exp(-1*discount_rate*start_year)
return(z)
}
declining_balance_sl<- function(discount_rate, asset_life, start_year, years_on, rate){
beta <- rate/asset_life
time_on_db <- asset_life*(1-(1/rate))
z_a<-(1-(beta/(beta))*(1-exp(-1*beta*start_year)))
z_b<-(beta/(beta+discount_rate))*(1-exp(-1*(beta+discount_rate)*min(years_on,max(time_on_db-start_year,0))))*exp(-1*discount_rate*start_year)
z_db<-z_a*z_b
z_sl<-((exp(-1*beta*time_on_db)/((asset_life-time_on_db)*discount_rate))*(exp(-1*discount_rate*max(time_on_db,start_year))-exp(-1*discount_rate*min(asset_life,years_on))))
z<-z_db+z_sl
return(z)
}
economic_depreciation<- function(discount_rate, start_year, years_on, rate){
rate/(rate+discount_rate)*(exp(-1*(rate+discount_rate)*start_year)-exp(-1*(rate+discount_rate)*(years_on+start_year)))
}
#Need to add AMT credits
service_price<-function(z_present_value, discount_rate, economic_depreciation, corporate_tax_rate, r_d_credit, inflation){
service_price<-(discount_rate - inflation + economic_depreciation)*(1 - corporate_tax_rate * z_present_value - r_d_credit)/ (1 - corporate_tax_rate)
}
inventories<-function(share_lifo, holding_period, discount_rate, inflation, corporate_tax_rate){
s_fifo<- (((1/ holding_period)* log((exp(discount_rate * holding_period)- corporate_tax_rate)/ (1-corporate_tax_rate)))-inflation)
s_lifo<- ((1/ holding_period) * log((exp((discount_rate - inflation) * holding_period)-corporate_tax_rate)/ (1-corporate_tax_rate)))
s<- s_fifo * (1-share_lifo) + s_lifo * share_lifo
return(s)
}
metr<-function(service_price, economic_depreciation, rate_of_return){
metr<-((service_price - economic_depreciation) - (rate_of_return - inflation))/(service_price - economic_depreciation)
return(metr)
}
cost_recovery_GDS<-function(gds_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on,
years_on_econ){
if(dep_method == "Expensing"){z <- 1}
if(dep_method == "Economic"){
z<-economic_depreciation(discount_rate, start_year, years_on_econ, econ_depreciation)
}
if(dep_method =="DB 200%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 2)
}
if(dep_method =="DB 150%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 1.5)
}
if(dep_method =="SL"){
z<-straight_line(discount_rate, gds_life, start_year, years_on)
}
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_ADS<-function(ads_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on){
z<-straight_line(discount_rate, ads_life, start_year, years_on)
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_econ<-function(discount_rate,
start_year,
years_on,
rate){
z<-economic_depreciation(discount_rate, start_year, years_on, rate)
return(z)
}
#Vectorize my functions
vads<-Vectorize(cost_recovery_ADS)
vecon<-Vectorize(cost_recovery_econ)
vgds<-Vectorize(cost_recovery_GDS)
vservice_price<-Vectorize(service_price)
vmetr<-Vectorize(metr)
#Testing code
#Z values
assets$ads_z<-vads(assets$ADS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$ADS.Life)
assets$econ_z<-vecon(discount_rate, 0, Inf, assets$delta)
assets$gds_z<-vgds(assets$GDS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$GDS.Life, Inf)
#Service Price
assets$s<-vservice_price(assets$gds_z, discount_rate, assets$delta, corporate_tax_rate, (assets$major_asset_group == "Intellectual Property") * r_d_credit, inflation)
#METR
assets$metr<-round(metr(assets$s,assets$delta, after_tax_return), digits = 3)
View(assets)
setwd("C:/Users/kylep/Documents/Github/book-tax")
rm(list=ls())
options(scipen = 999)
assets<-read.csv("asset_data.csv", header = TRUE, fill = TRUE, sep = ",")
#Parameters
corporate_tax_rate <- .21
debt_finance_share <- .32
interest_rate <- 0.068
interest_limit <- (1-0.16)
inflation <- 0.024
return_on_equity<-.058
r_d_credit<-0.0217
after_tax_return<-interest_rate * debt_finance_share + (return_on_equity + inflation) * (1-debt_finance_share)
discount_rate <- debt_finance_share * (interest_rate * (1 - (interest_limit)*corporate_tax_rate)) +
(1-debt_finance_share) * (return_on_equity+inflation)
straight_line<- function(discount_rate, asset_life, start_year, years_on){
z <- ((1-exp(-1*discount_rate*years_on))/(discount_rate*asset_life))*exp(-1*discount_rate*start_year)
return(z)
}
declining_balance_sl<- function(discount_rate, asset_life, start_year, years_on, rate){
beta <- rate/asset_life
time_on_db <- asset_life*(1-(1/rate))
z_a<-(1-(beta/(beta))*(1-exp(-1*beta*start_year)))
z_b<-(beta/(beta+discount_rate))*(1-exp(-1*(beta+discount_rate)*min(years_on,max(time_on_db-start_year,0))))*exp(-1*discount_rate*start_year)
z_db<-z_a*z_b
z_sl<-((exp(-1*beta*time_on_db)/((asset_life-time_on_db)*discount_rate))*(exp(-1*discount_rate*max(time_on_db,start_year))-exp(-1*discount_rate*min(asset_life,years_on))))
z<-z_db+z_sl
return(z)
}
economic_depreciation<- function(discount_rate, start_year, years_on, rate){
rate/(rate+discount_rate)*(exp(-1*(rate+discount_rate)*start_year)-exp(-1*(rate+discount_rate)*(years_on+start_year)))
}
#Need to add AMT credits
service_price<-function(z_present_value, discount_rate, economic_depreciation, corporate_tax_rate, r_d_credit, inflation){
service_price<-(discount_rate - inflation + economic_depreciation)*(1 - corporate_tax_rate * z_present_value - r_d_credit)/ (1 - corporate_tax_rate)
}
inventories<-function(share_lifo, holding_period, discount_rate, inflation, corporate_tax_rate){
s_fifo<- (((1/ holding_period)* log((exp(discount_rate * holding_period)- corporate_tax_rate)/ (1-corporate_tax_rate)))-inflation)
s_lifo<- ((1/ holding_period) * log((exp((discount_rate - inflation) * holding_period)-corporate_tax_rate)/ (1-corporate_tax_rate)))
s<- s_fifo * (1-share_lifo) + s_lifo * share_lifo
return(s)
}
metr<-function(service_price, economic_depreciation, rate_of_return){
metr<-((service_price - economic_depreciation) - (rate_of_return - inflation))/(service_price - economic_depreciation)
return(metr)
}
cost_recovery_GDS<-function(gds_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on,
years_on_econ){
if(dep_method == "Expensing"){z <- 1}
if(dep_method == "Economic"){
z<-economic_depreciation(discount_rate, start_year, years_on_econ, econ_depreciation)
}
if(dep_method =="DB 200%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 2)
}
if(dep_method =="DB 150%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 1.5)
}
if(dep_method =="SL"){
z<-straight_line(discount_rate, gds_life, start_year, years_on)
}
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_ADS<-function(ads_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on){
z<-straight_line(discount_rate, ads_life, start_year, years_on)
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_econ<-function(discount_rate,
start_year,
years_on,
rate){
z<-economic_depreciation(discount_rate, start_year, years_on, rate)
return(z)
}
#Vectorize my functions
vads<-Vectorize(cost_recovery_ADS)
vecon<-Vectorize(cost_recovery_econ)
vgds<-Vectorize(cost_recovery_GDS)
vservice_price<-Vectorize(service_price)
vmetr<-Vectorize(metr)
#Testing code
#Z values
assets$ads_z<-vads(assets$ADS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$ADS.Life)
assets$econ_z<-vecon(discount_rate, 0, Inf, assets$delta)
assets$gds_z<-vgds(assets$GDS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$GDS.Life, Inf)
#Service Price
assets$s<-vservice_price(assets$gds_z, discount_rate, assets$delta, corporate_tax_rate, (assets$major_asset_group == "Intellectual Property") * r_d_credit, inflation)
#METR
assets$metr<-round(metr(assets$s,assets$delta, after_tax_return), digits = 3)
View(assets)
setwd("C:/Users/kylep/Documents/Github/book-tax")
rm(list=ls())
options(scipen = 999)
assets<-read.csv("asset_data.csv", header = TRUE, fill = TRUE, sep = ",")
#Parameters
corporate_tax_rate <- .21
debt_finance_share <- .32
interest_rate <- 0.068
interest_limit <- (1-0.16)
inflation <- 0.024
return_on_equity<-.058
r_d_credit<-0.0217
after_tax_return<-interest_rate * debt_finance_share + (return_on_equity + inflation) * (1-debt_finance_share)
discount_rate <- debt_finance_share * (interest_rate * (1 - (interest_limit)*corporate_tax_rate)) +
(1-debt_finance_share) * (return_on_equity+inflation)
straight_line<- function(discount_rate, asset_life, start_year, years_on){
z <- ((1-exp(-1*discount_rate*years_on))/(discount_rate*asset_life))*exp(-1*discount_rate*start_year)
return(z)
}
declining_balance_sl<- function(discount_rate, asset_life, start_year, years_on, rate){
beta <- rate/asset_life
time_on_db <- asset_life*(1-(1/rate))
z_a<-(1-(beta/(beta))*(1-exp(-1*beta*start_year)))
z_b<-(beta/(beta+discount_rate))*(1-exp(-1*(beta+discount_rate)*min(years_on,max(time_on_db-start_year,0))))*exp(-1*discount_rate*start_year)
z_db<-z_a*z_b
z_sl<-((exp(-1*beta*time_on_db)/((asset_life-time_on_db)*discount_rate))*(exp(-1*discount_rate*max(time_on_db,start_year))-exp(-1*discount_rate*min(asset_life,years_on))))
z<-z_db+z_sl
return(z)
}
economic_depreciation<- function(discount_rate, start_year, years_on, rate){
rate/(rate+discount_rate)*(exp(-1*(rate+discount_rate)*start_year)-exp(-1*(rate+discount_rate)*(years_on+start_year)))
}
#Need to add AMT credits
service_price<-function(z_present_value, discount_rate, economic_depreciation, corporate_tax_rate, r_d_credit, inflation){
service_price<-(discount_rate - inflation + economic_depreciation)*(1 - corporate_tax_rate * z_present_value - r_d_credit)/ (1 - corporate_tax_rate)
}
inventories<-function(share_lifo, holding_period, discount_rate, inflation, corporate_tax_rate){
s_fifo<- (((1/ holding_period)* log((exp(discount_rate * holding_period)- corporate_tax_rate)/ (1-corporate_tax_rate)))-inflation)
s_lifo<- ((1/ holding_period) * log((exp((discount_rate - inflation) * holding_period)-corporate_tax_rate)/ (1-corporate_tax_rate)))
s<- s_fifo * (1-share_lifo) + s_lifo * share_lifo
return(s)
}
metr<-function(service_price, economic_depreciation, rate_of_return){
metr<-((service_price - economic_depreciation) - (rate_of_return - inflation))/(service_price - economic_depreciation)
return(metr)
}
cost_recovery_GDS<-function(gds_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on,
years_on_econ){
if(dep_method == "Expensing"){z <- 1}
if(dep_method == "Economic"){
z<-economic_depreciation(discount_rate, start_year, years_on_econ, econ_depreciation)
}
if(dep_method =="DB 200%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 2)
}
if(dep_method =="DB 150%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 1.5)
}
if(dep_method =="SL"){
z<-straight_line(discount_rate, gds_life, start_year, years_on)
}
#if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_ADS<-function(ads_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on){
z<-straight_line(discount_rate, ads_life, start_year, years_on)
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_econ<-function(discount_rate,
start_year,
years_on,
rate){
z<-economic_depreciation(discount_rate, start_year, years_on, rate)
return(z)
}
#Vectorize my functions
vads<-Vectorize(cost_recovery_ADS)
vecon<-Vectorize(cost_recovery_econ)
vgds<-Vectorize(cost_recovery_GDS)
vservice_price<-Vectorize(service_price)
vmetr<-Vectorize(metr)
#Testing code
#Z values
assets$ads_z<-vads(assets$ADS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$ADS.Life)
assets$econ_z<-vecon(discount_rate, 0, Inf, assets$delta)
assets$gds_z<-vgds(assets$GDS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$GDS.Life, Inf)
#Service Price
assets$s<-vservice_price(assets$gds_z, discount_rate, assets$delta, corporate_tax_rate, (assets$major_asset_group == "Intellectual Property") * r_d_credit, inflation)
#METR
assets$metr<-round(metr(assets$s,assets$delta, after_tax_return), digits = 3)
View(vgds)
setwd("C:/Users/kylep/Documents/Github/book-tax")
rm(list=ls())
options(scipen = 999)
assets<-read.csv("asset_data.csv", header = TRUE, fill = TRUE, sep = ",")
#Parameters
corporate_tax_rate <- .21
debt_finance_share <- .32
interest_rate <- 0.068
interest_limit <- (1-0.16)
inflation <- 0.024
return_on_equity<-.058
r_d_credit<-0.0217
after_tax_return<-interest_rate * debt_finance_share + (return_on_equity + inflation) * (1-debt_finance_share)
discount_rate <- debt_finance_share * (interest_rate * (1 - (interest_limit)*corporate_tax_rate)) +
(1-debt_finance_share) * (return_on_equity+inflation)
straight_line<- function(discount_rate, asset_life, start_year, years_on){
z <- ((1-exp(-1*discount_rate*years_on))/(discount_rate*asset_life))*exp(-1*discount_rate*start_year)
return(z)
}
declining_balance_sl<- function(discount_rate, asset_life, start_year, years_on, rate){
beta <- rate/asset_life
time_on_db <- asset_life*(1-(1/rate))
z_a<-(1-(beta/(beta))*(1-exp(-1*beta*start_year)))
z_b<-(beta/(beta+discount_rate))*(1-exp(-1*(beta+discount_rate)*min(years_on,max(time_on_db-start_year,0))))*exp(-1*discount_rate*start_year)
z_db<-z_a*z_b
z_sl<-((exp(-1*beta*time_on_db)/((asset_life-time_on_db)*discount_rate))*(exp(-1*discount_rate*max(time_on_db,start_year))-exp(-1*discount_rate*min(asset_life,years_on))))
z<-z_db+z_sl
return(z)
}
economic_depreciation<- function(discount_rate, start_year, years_on, rate){
rate/(rate+discount_rate)*(exp(-1*(rate+discount_rate)*start_year)-exp(-1*(rate+discount_rate)*(years_on+start_year)))
}
#Need to add AMT credits
service_price<-function(z_present_value, discount_rate, economic_depreciation, corporate_tax_rate, r_d_credit, inflation){
service_price<-(discount_rate - inflation + economic_depreciation)*(1 - corporate_tax_rate * z_present_value - r_d_credit)/ (1 - corporate_tax_rate)
}
inventories<-function(share_lifo, holding_period, discount_rate, inflation, corporate_tax_rate){
s_fifo<- (((1/ holding_period)* log((exp(discount_rate * holding_period)- corporate_tax_rate)/ (1-corporate_tax_rate)))-inflation)
s_lifo<- ((1/ holding_period) * log((exp((discount_rate - inflation) * holding_period)-corporate_tax_rate)/ (1-corporate_tax_rate)))
s<- s_fifo * (1-share_lifo) + s_lifo * share_lifo
return(s)
}
metr<-function(service_price, economic_depreciation, rate_of_return){
metr<-((service_price - economic_depreciation) - (rate_of_return - inflation))/(service_price - economic_depreciation)
return(metr)
}
cost_recovery_GDS<-function(gds_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on,
years_on_econ){
if(dep_method == "Expensing"){z <- 1}
if(dep_method == "Economic"){
z<-economic_depreciation(discount_rate, start_year, years_on_econ, econ_depreciation)
}
if(dep_method =="DB 200%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 2)
}
if(dep_method =="DB 150%"){
z<-declining_balance_sl(discount_rate, gds_life, start_year, years_on, 1.5)
}
if(dep_method =="SL"){
z<-straight_line(discount_rate, gds_life, start_year, years_on)
}
return(z)
}
cost_recovery_ADS<-function(ads_life,
econ_depreciation,
system,
dep_method,
discount_rate,
start_year,
years_on){
z<-straight_line(discount_rate, ads_life, start_year, years_on)
if(dep_method == "Land"){z<-0}
return(z)
}
cost_recovery_econ<-function(discount_rate,
start_year,
years_on,
rate){
z<-economic_depreciation(discount_rate, start_year, years_on, rate)
return(z)
}
#Vectorize my functions
vads<-Vectorize(cost_recovery_ADS)
vecon<-Vectorize(cost_recovery_econ)
vgds<-Vectorize(cost_recovery_GDS)
vservice_price<-Vectorize(service_price)
vmetr<-Vectorize(metr)
#Testing code
#Z values
assets$ads_z<-vads(assets$ADS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$ADS.Life)
assets$econ_z<-vecon(discount_rate, 0, Inf, assets$delta)
assets$gds_z<-vgds(assets$GDS.Life, assets$delta, assets$System, assets$Method, discount_rate, 0, assets$GDS.Life, Inf)
#Service Price
assets$s<-vservice_price(assets$gds_z, discount_rate, assets$delta, corporate_tax_rate, (assets$major_asset_group == "Intellectual Property") * r_d_credit, inflation)
#METR
assets$metr<-round(metr(assets$s,assets$delta, after_tax_return), digits = 3)
